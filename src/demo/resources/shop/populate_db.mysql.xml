<?xml version="1.0" encoding="iso-8859-1"?>
<!--DOCTYPE setup SYSTEM "http://databene.org/benerator-0.3.03.dtd"-->
<setup>

    <bean id="db" class="org.databene.platform.db.adapter.DBSystem">
        <property name="url" value="jdbc:mysql://localhost/benerator"/>
        <property name="driver" value="com.mysql.jdbc.Driver"/>
        <property name="user" value="benerator"/>
        <property name="password" value="benerator"/>
    </bean>

    <run-task class="org.databene.platform.db.adapter.RunSqlScriptTask">
        <property name="uri" value="shop/drop_tables.sql"/>
        <property name="db" ref="db"/>
        <property name="haltOnError" value="false"/>
    </run-task>

    <run-task class="org.databene.platform.db.adapter.RunSqlScriptTask">
        <property name="uri" value="shop/create_tables.mysql.sql"/>
        <property name="db" ref="db"/>
    </run-task>

    <!-- import basic setup from a DBUnit file -->
    <create-entities source="shop/shop.dbunit.xml" processor="db"/>

    <!-- import products from a CSV file -->
    <create-entities name="db_product" source="shop/products.import.csv" processor="db"/>

    <!-- add products of random category -->
    <create-entities name="db_product" count="100" pagesize="1000" threads="2">
        <attribute name="category_id" source="db" selector="select id from db_category" cyclic="true"/>
        <attribute name="ean_code" generator="org.databene.domain.product.EANGenerator" unique="true"/>
        <attribute name="name" pattern="[A-Z][a-z]{5,12}"/>
        <processor ref="db"/>
        <processor class="org.databene.platform.flat.FlatFileEntityExporter">
            <property name="uri" value="products.flat"/>
            <property name="properties" value="ean_code[13],name[30l],price[10.2r0]"/>
        </processor>
    </create-entities>

    <!-- create customers -->

    <create-entities name="db_user" count="10" pagesize="100" threads="2">
        <attribute name="id" mode="ignored"/>
        <attribute name="email" pattern="[a-z]{5,8}[0-9]{0,2}@[a-z]{8,12}\.(de|at|ch|com|org)"/>
        <attribute name="password" pattern="[A-Za-z0-9]{8,12}"/>
        <attribute name="role_id" values="customer"/>
        <processor class="org.databene.platform.csv.CSVEntityExporter">
            <property name="uri" value="customers.csv"/>
            <property name="properties" value="name,password"/>
        </processor>
        <processor ref="db"/>
    </create-entities>

    <create-entities name="db_customer" pagesize="100" threads="2">
        <variable name="person" generator="org.databene.domain.person.PersonGenerator" region="DE" locale="DE"/>
        <attribute name="id" source="db" selector="select id from db_user where role_id='customer' and id>3"/>
        <attribute name="category" values="A,B,C"/>
        <attribute name="salutation" source="person.salutation"/>
        <attribute name="first_name" source="person.givenName"/>
        <attribute name="last_name" source="person.familyName"/>
        <processor ref="db"/>
    </create-entities>

    <!-- create orders for random customers and random products -->

    <create-entities name="db_order" count="10" pagesize="100" threads="2">
        <attribute name="id" mode="ignored"/>
        <attribute name="customer_id" source="db" selector="select id from db_customer" cyclic="true"/>
        <processor ref="db"/>
    </create-entities>

    <create-entities name="db_order_item" count="10" pagesize="100" threads="2">
        <attribute name="id" mode="ignored"/>
        <attribute name="number_of_items" min="1" max="27" distribution="cumulated"/>
        <attribute name="order_id" source="db" selector="select id from db_order" cyclic="true"/>
        <attribute name="product_ean_code" source="db" selector="select ean_code from db_product" distribution="cumulated"/>
        <processor ref="db"/>
    </create-entities>

</setup>