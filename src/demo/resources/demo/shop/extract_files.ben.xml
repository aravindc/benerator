<?xml version="1.0" encoding="iso-8859-1"?>
<!--DOCTYPE setup SYSTEM "http://databene.org/benerator-0.3.dtd"-->
<setup>

    <bean id="db" class="org.databene.platform.db.adapter.DBSystem">
        <property name="url" value="jdbc:oracle:thin:@localhost:1521:XE"/>
        <property name="driver" value="oracle.jdbc.driver.OracleDriver"/>
        <property name="user" value="benerator"/>
        <property name="password" value="benerator"/>
        <property name="batch" value="true"/>
    </bean>
    
    <create-entities name="db_product" source="db">
        <consumer id="flat" class="org.databene.platform.flat.FlatFileEntityExporter">
            <property name="uri" value="products.flat"/>
            <property name="properties" value="ean_code[13],name[30l],price[10r0]"/>
        </consumer>
    </create-entities>

    <bean id="csv" class="org.databene.platform.csv.CSVEntityExporter">
        <property name="uri" value="customers.csv"/>
        <property name="properties" value="salutation,first_name,last_name"/>
    </bean>

    <bean id="proxy" class="shop.MyProxy">
        <property name="target" ref="csv"/>
    </bean>

    <bean id="log-csv" class="org.databene.model.consumer.ConsumerChain">
        <property name="components">
            <bean class="org.databene.model.consumer.LoggingConsumer"/>
            <idref bean="proxy"/>
        </property>
    </bean>

    <!-- this anonymizes the family name of the data extracted from the DB -->
    <create-entities name="db_customer" source="db">
        <attribute name="last_name" generator="org.databene.domain.person.FamilyNameGenerator"/>
        <consumer ref="log-csv"/>
    </create-entities>
    
    <!-- write a complete database snapshot to a DbUnit file -->
    <bean id="dbunit" class="org.databene.platform.dbunit.DbUnitEntityExporter">
        <property name="uri" value="snapshot.xml"/>
    </bean>

    <create-entities name="db_category"   source="db" consumer="dbunit"/>
    <create-entities name="db_product"    source="db" consumer="dbunit"/>
    <create-entities name="db_role"       source="db" consumer="dbunit"/>
    <create-entities name="db_user"       source="db" consumer="dbunit"/>
    <create-entities name="db_customer"   source="db" consumer="dbunit"/>
    <create-entities name="db_order"      source="db" consumer="dbunit"/>
    <create-entities name="db_order_item" source="db" consumer="dbunit"/>
    
</setup>